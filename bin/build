#!/usr/bin/env bash

PROJECT_ID=010001111
PROJECT=bolt
PROJECT_IN_UPPERCASE=$(echo "$PROJECT" | tr '[:lower:]' '[:upper:]')
SCRIPT_SOURCE_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

cd "$SCRIPT_SOURCE_DIR/.." || exit
source "bin/lib/docker-utilities" || exit

if [[ $(isDockerRunning) == 'false' ]]; then
  echo Please make sure that docker is installed and running.
  echo

  exit 1
fi

areContainersBuilt=$(areContainersBuilt $PROJECT_ID-$PROJECT)

if [[ $areContainersBuilt == 'false' ]]; then
  echo
  echo "$PROJECT_IN_UPPERCASE containers are not built. Running: \`$SCRIPT_SOURCE_DIR/docker-helper build\`"
  echo

  bin/docker-helper build
fi

areContainersRunning=$(areContainersRunning $PROJECT_ID-$PROJECT)

if [[ $areContainersRunning == 'false' ]]; then
  echo
  echo "$PROJECT_IN_UPPERCASE containers are not started. Running: \`$SCRIPT_SOURCE_DIR/docker-helper start\`"
  echo

  bin/docker-helper start
fi

bin/docker-helper exec 010001111-bolt-php bin/composer install
