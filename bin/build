#!/usr/bin/env bash

readonly PROJECT_ID=010001111
readonly PROJECT=bolt
readonly PROJECT_IN_UPPERCASE=$(printf "%s" "$PROJECT" | tr '[:lower:]' '[:upper:]')
readonly SCRIPT_SOURCE_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

cd "$SCRIPT_SOURCE_DIR/.." || exit
# shellcheck source=lib/docker-utilities
source "$SCRIPT_SOURCE_DIR/lib/docker-utilities" || exit

if [[ "$(is_docker_running)" == 'false' ]]; then
  printf "Please make sure that docker is installed and running.\n"
  printf "\n"

  exit 1
fi

are_containers_built=$(are_containers_built $PROJECT_ID-$PROJECT)

if [[ $are_containers_built == 'false' ]]; then
  printf "\n"
  printf "%s containers are not built. Running: \`%s/docker-helper build\`" "$PROJECT_IN_UPPERCASE" "$SCRIPT_SOURCE_DIR"
  printf "\n"

  bin/docker-helper build
fi

are_containers_running=$(are_containers_running $PROJECT_ID-$PROJECT)

if [[ $are_containers_running == 'false' ]]; then
  printf "\n"
  printf "%s containers are not started. Running: \`%s/docker-helper start\`" "$PROJECT_IN_UPPERCASE" "$SCRIPT_SOURCE_DIR"
  printf "\n"

  bin/docker-helper start
fi

bin/docker-helper exec 010001111-bolt-php bin/composer install
